var DashApi=function(e){"use strict";"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function t(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}var n=t((function(e,t){e.exports=function(){var e,t,n={},o=!1,r=[],s=[],i=0;return(n={version:"2.3.8-javascript",onError:function(e){},onClose:function(e){},onOpen:function(e){},onReopen:function(e){},onMessage:function(e){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){},WebsocketApiAdapter:function(e){var t,o;return e.onMessage=function(e){o.onmessage({data:e.responseBody})},e.onMessagePublished=function(e){o.onmessage({data:e.responseBody})},e.onOpen=function(e){o.onopen(e)},o={close:function(){t.close()},send:function(e){t.push(e)},onmessage:function(e){},onopen:function(e){},onclose:function(e){},onerror:function(e){}},t=new n.subscribe(e),o},AtmosphereRequest:function(e){var t,r,a,c={timeout:3e5,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:!0,maxRequest:-1,reconnect:!0,maxStreamingLength:1e7,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:!1,rewriteURL:!1,attachHeadersAsQueryString:!0,executeCallbackBeforeReconnect:!1,readyState:0,withCredentials:!1,trackMessageLength:!1,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:!0,uuid:0,async:!0,shared:!1,readResponsesHeaders:!1,maxReconnectOnClose:5,enableProtocol:!0,disableDisconnect:!1,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,closeAsync:!1,reconnectOnServerError:!0,handleOnlineOffline:!0,maxWebsocketErrorRetries:1,curWebsocketErrorRetries:0,onError:function(e){},onClose:function(e){},onOpen:function(e){},onMessage:function(e){},onReopen:function(e,t){},onReconnect:function(e,t){},onMessagePublished:function(e){},onTransportFailure:function(e,t){},onLocalMessage:function(e){},onFailureToReconnect:function(e,t){},onClientTimeout:function(e){},onOpenAfterResume:function(e){}},l={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:!1,closedByClientTimeout:!1,ffTryingReconnect:!1},u=null,d=null,h=null,p=null,f=null,g=!0,m=0,v=0,b="X",w=!1,y=null,C=null,k=n.util.now();function S(){g=!0,w=!1,m=0,u=null,d=null,h=null,p=null}function T(){q(),S()}function I(e){return"debug"==e?"debug"===c.logLevel:"info"==e?"info"===c.logLevel||"debug"===c.logLevel:"warn"==e?"warn"===c.logLevel||"info"===c.logLevel||"debug"===c.logLevel:"error"==e&&("error"===c.logLevel||"warn"===c.logLevel||"info"===c.logLevel||"debug"===c.logLevel)}function R(e){I("debug")&&n.util.debug(new Date+" Atmosphere: "+e)}function x(e,t){return""===l.partialMessage&&"streaming"===t.transport&&e.responseText.length>t.maxStreamingLength}function O(){if(c.enableProtocol&&!c.disableDisconnect&&!c.firstMessage){var e="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+c.uuid;n.util.each(c.headers,(function(t,o){var r=n.util.isFunction(o)?o.call(this,c,c,l):o;null!=r&&(e+="&"+encodeURIComponent(t)+"="+encodeURIComponent(r))}));var t=c.url.replace(/([?&])_=[^&]*/,e);t+=t===c.url?(/\?/.test(c.url)?"&":"?")+e:"";var o={connected:!1},r=new n.AtmosphereRequest(o);r.connectTimeout=c.connectTimeout,r.attachHeadersAsQueryString=!1,r.dropHeaders=!0,r.url=t,r.contentType="text/plain",r.transport="polling",r.method="GET",r.data="",r.heartbeat=null,c.enableXDR&&(r.enableXDR=c.enableXDR),r.async=c.closeAsync,de("",r)}}function E(){R("Closing (AtmosphereRequest._close() called)"),w=!0,c.reconnectId&&(clearTimeout(c.reconnectId),delete c.reconnectId),c.heartbeatTimer&&clearTimeout(c.heartbeatTimer),c.reconnect=!1,l.request=c,l.state="unsubscribe",l.responseBody="",l.status=408,l.partialMessage="",c.curWebsocketErrorRetries=0,Re(),O(),q()}function q(){l.partialMessage="",c.id&&clearTimeout(c.id),c.heartbeatTimer&&clearTimeout(c.heartbeatTimer),c.reconnectId&&(clearTimeout(c.reconnectId),delete c.reconnectId),null!=p&&(p.close(),p=null),null!=f&&(f.abort(),f=null),null!=h&&(h.abort(),h=null),null!=u&&(u.canSendMessage&&(R("invoking .close() on WebSocket object"),u.close()),u=null),null!=d&&(d.close(),d=null),M()}function M(){null!=t&&(clearInterval(r),document.cookie=a+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",t.signal("close",{reason:"",heir:w?(t.get("children")||[])[0]:k}),t.close()),null!=C&&C.close()}function A(e){T(),(c=n.util.extend(c,e)).mrequest=c.reconnect,c.reconnect||(c.reconnect=!0)}function F(){return null!=c.webSocketImpl||window.WebSocket||window.MozWebSocket}function P(){var e=n.util.getAbsoluteURL(c.url.toLowerCase()),t=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(e),o=!(!t||t[1]==window.location.protocol&&t[2]==window.location.hostname&&(t[3]||("http:"===t[1]?80:443))==(window.location.port||("http:"===window.location.protocol?80:443)));return window.EventSource&&(!o||!n.util.browser.safari||n.util.browser.vmajor>=7)}function U(){if(c.shared){if(null!=(C=L(c))&&(I("debug")&&n.util.debug("Storage service available. All communication will be local"),C.open(c)))return;I("debug")&&n.util.debug("No Storage service available."),C=null}c.firstMessage=0==i,c.isOpen=!1,c.ctime=n.util.now(),0===c.uuid&&(c.uuid=i),l.closedByClientTimeout=!1,"websocket"!==c.transport&&"sse"!==c.transport?ee(c):"websocket"===c.transport?F()?X(!1):G("Websocket is not supported, using request.fallbackTransport ("+c.fallbackTransport+")"):"sse"===c.transport&&(P()?H(!1):G("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+c.fallbackTransport+")"))}function L(e){var t,o,s,i="atmosphere-"+e.url,a={storage:function(){function t(e){e.key===i&&e.newValue&&u(e.newValue)}if(n.util.storage){var o=window.localStorage,r=function(e){var t=o.getItem(i+"-"+e);return null===t?[]:JSON.parse(t)},s=function(e,t){o.setItem(i+"-"+e,JSON.stringify(t))};return{init:function(){return s("children",r("children").concat([k])),n.util.on(window,"storage",t),r("opened")},signal:function(e,t){o.setItem(i,JSON.stringify({target:"p",type:e,data:t}))},close:function(){var o=r("children");n.util.off(window,"storage",t),o&&l(o,e.id)&&s("children",o)}}}},windowref:function(){var e=window.open("",i.replace(/\W/g,""));if(e&&!e.closed&&e.callbacks)return{init:function(){return e.callbacks.push(u),e.children.push(k),e.opened},signal:function(t,n){!e.closed&&e.fire&&e.fire(JSON.stringify({target:"p",type:t,data:n}))},close:function(){s||(l(e.callbacks,u),l(e.children,k))}}}};function l(e,t){var n,o=e.length;for(n=0;n<o;n++)e[n]===t&&e.splice(n,1);return o!==e.length}function u(t){var n=JSON.parse(t),o=n.data;if("c"===n.target)switch(n.type){case"open":N("opening","local",c);break;case"close":s||(s=!0,"aborted"===o.reason?E():o.heir===k?U():setTimeout((function(){U()}),100));break;case"message":Ce(o,"messageReceived",200,e.transport);break;case"localMessage":ye(o)}}function d(){var e=new RegExp("(?:^|; )("+encodeURIComponent(i)+")=([^;]*)").exec(document.cookie);if(e)return JSON.parse(decodeURIComponent(e[2]))}if((t=d())&&!(n.util.now()-t.ts>1e3)&&(o=a.storage()||a.windowref()))return{open:function(){var n;return r=setInterval((function(){var e=t;(t=d())&&e.ts!==t.ts||u(JSON.stringify({target:"c",type:"close",data:{reason:"error",heir:e.heir}}))}),1e3),(n=o.init())&&setTimeout((function(){N("opening","local",e)}),50),n},send:function(e){o.signal("send",e)},localSend:function(e){o.signal("localSend",JSON.stringify({id:k,event:e}))},close:function(){w||(clearInterval(r),o.signal("close"),o.close())}}}function _(){var e,o="atmosphere-"+c.url,s={storage:function(){function e(e){e.key===o&&e.newValue&&i(e.newValue)}if(n.util.storage){var t=window.localStorage;return{init:function(){n.util.on(window,"storage",e)},signal:function(e,n){t.setItem(o,JSON.stringify({target:"c",type:e,data:n}))},get:function(e){return JSON.parse(t.getItem(o+"-"+e))},set:function(e,n){t.setItem(o+"-"+e,JSON.stringify(n))},close:function(){n.util.off(window,"storage",e),t.removeItem(o),t.removeItem(o+"-opened"),t.removeItem(o+"-children")}}}},windowref:function(){var e,t=o.replace(/\W/g,""),n=document.getElementById(t);return n||((n=document.createElement("div")).id=t,n.style.display="none",n.innerHTML='<iframe name="'+t+'" />',document.body.appendChild(n)),e=n.firstChild.contentWindow,{init:function(){e.callbacks=[i],e.fire=function(t){var n;for(n=0;n<e.callbacks.length;n++)e.callbacks[n](t)}},signal:function(t,n){!e.closed&&e.fire&&e.fire(JSON.stringify({target:"c",type:t,data:n}))},get:function(t){return e.closed?null:e[t]},set:function(t,n){e.closed||(e[t]=n)},close:function(){}}}};function i(e){var t=JSON.parse(e),n=t.data;if("p"===t.target)switch(t.type){case"send":ue(n);break;case"localSend":ye(n);break;case"close":E()}}function l(){document.cookie=a+"="+encodeURIComponent(JSON.stringify({ts:n.util.now()+1,heir:(e.get("children")||[])[0]}))+"; path=/"}y=function(t){e.signal("message",t)},(e=s.storage()||s.windowref()).init(),I("debug")&&n.util.debug("Installed StorageService "+e),e.set("children",[]),null==e.get("opened")||e.get("opened")||e.set("opened",!1),a=encodeURIComponent(o),l(),r=setInterval(l,1e3),t=e}function N(e,n,o){if(c.shared&&"local"!==n&&_(),null!=t&&t.set("opened",!0),o.close=function(){E()},m>0&&"re-connecting"===e)o.isReopen=!0,re(l);else if(null==l.error){l.request=o;var r=l.state;l.state=e;var s=l.transport;l.transport=n;var i=l.responseBody;Re(),l.responseBody=i,l.state=r,l.transport=s}}function D(e){e.transport="jsonp";var t,o=c;null!=e&&void 0!==e&&(o=e),(f={open:function(){var r="atmosphere"+ ++k;function s(){o.lastIndex=0,o.openId&&clearTimeout(o.openId),o.heartbeatTimer&&clearTimeout(o.heartbeatTimer),o.reconnect&&m++<o.maxReconnectOnClose?(N("re-connecting",o.transport,o),oe(f,o,e.reconnectInterval),o.openId=setTimeout((function(){Z(o)}),o.reconnectInterval+1e3)):V(0,"maxReconnectOnClose reached")}function i(){var n=o.url;null!=o.dispatchUrl&&(n+=o.dispatchUrl);var i=o.data;o.attachHeadersAsQueryString&&(n=K(o),""!==i&&(n+="&X-Atmosphere-Post-Body="+encodeURIComponent(i)),i="");var a=document.head||document.getElementsByTagName("head")[0]||document.documentElement;(t=document.createElement("script")).src=n+"&jsonpTransport="+r,t.clean=function(){t.clean=t.onerror=t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),2==++e.scriptCount&&(e.scriptCount=1,s())},t.onload=t.onreadystatechange=function(){R("jsonp.onload"),t.readyState&&!/loaded|complete/.test(t.readyState)||t.clean()},t.onerror=function(){R("jsonp.onerror"),e.scriptCount=1,t.clean()},a.insertBefore(t,a.firstChild)}window[r]=function(t){if(R("jsonp.window"),e.scriptCount=0,o.reconnect&&-1===o.maxRequest||o.requestCount++<o.maxRequest){if(o.executeCallbackBeforeReconnect||oe(f,o,o.pollingInterval),null!=t&&"string"!=typeof t)try{t=t.message}catch(e){}$(t,o,l)||Ce(l.responseBody,"messageReceived",200,o.transport),o.executeCallbackBeforeReconnect&&oe(f,o,o.pollingInterval),z(o)}else n.util.log(c.logLevel,["JSONP reconnect maximum try reached "+c.requestCount]),V(0,"maxRequest reached")},setTimeout((function(){i()}),50)},abort:function(){t&&t.clean&&t.clean()}}).open()}function B(e){return null!=c.webSocketImpl?c.webSocketImpl:window.WebSocket?new WebSocket(e):new MozWebSocket(e)}function j(){return K(c,n.util.getAbsoluteURL(c.webSocketUrl||c.url)).replace(/^http/,"ws")}function W(){return K(c)}function H(e){l.transport="sse";var t=W();if(I("debug")&&(n.util.debug("Invoking executeSSE"),n.util.debug("Using URL: "+t)),!e||c.reconnect){try{d=new EventSource(t,{withCredentials:c.withCredentials})}catch(e){return V(0,e),void G("SSE failed. Downgrading to fallback transport and resending")}c.connectTimeout>0&&(c.id=setTimeout((function(){e||q()}),c.connectTimeout)),d.onopen=function(t){R("sse.onopen"),z(c),I("debug")&&n.util.debug("SSE successfully opened"),c.enableProtocol?c.isReopen&&(c.isReopen=!1,N("re-opening",c.transport,c)):N(e?"re-opening":"opening","sse",c),e=!0,"POST"===c.method&&(l.state="messageReceived",ue(c.data))},d.onmessage=function(e){R("sse.onmessage"),z(c),!c.enableXDR&&window.location.host&&e.origin&&e.origin!==window.location.protocol+"//"+window.location.host?n.util.log(c.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]):(l.state="messageReceived",l.status=200,$(e=e.data,c,l)||(Re(),l.responseBody="",l.messages=[]))},d.onerror=function(t){R("sse.onerror"),clearTimeout(c.id),c.heartbeatTimer&&clearTimeout(c.heartbeatTimer),l.closedByClientTimeout||(Ie(e),q(),w?n.util.log(c.logLevel,["SSE closed normally"]):e?c.reconnect&&"sse"===l.transport&&(m++<c.maxReconnectOnClose?(N("re-connecting",c.transport,c),c.reconnectInterval>0?c.reconnectId=setTimeout((function(){H(!0)}),c.reconnectInterval):H(!0),l.responseBody="",l.messages=[]):(n.util.log(c.logLevel,["SSE reconnect maximum try reached "+m]),V(0,"maxReconnectOnClose reached"))):G("SSE failed. Downgrading to fallback transport and resending"))}}else null!=d&&q()}function X(e){l.transport="websocket";var t=j(c.url);I("debug")&&n.util.debug("Invoking executeWebSocket, using URL: "+t),!e||c.reconnect?(u=B(t),null!=c.webSocketBinaryType&&(u.binaryType=c.webSocketBinaryType),c.connectTimeout>0&&(c.id=setTimeout((function(){if(e);else{var t={code:1002,reason:"",wasClean:!1};u.onclose(t);try{q()}catch(e){}}}),c.connectTimeout)),u.onopen=function(t){R("websocket.onopen"),z(c),o=!1,I("debug")&&n.util.debug("Websocket successfully opened");var r=e;null!=u&&(u.canSendMessage=!0),c.enableProtocol||(e=!0,N(r?"re-opening":"opening","websocket",c)),null!=u&&"POST"===c.method&&(l.state="messageReceived",u.send(c.data))},u.onmessage=function(t){if(R("websocket.onmessage"),z(c),c.enableProtocol&&(e=!0),l.state="messageReceived",l.status=200,"string"==typeof(t=t.data))$(t,c,l)||(Re(),l.responseBody="",l.messages=[]);else{if(""===(t=J(c,t)))return;l.responseBody=t,Re(),l.responseBody=null}},u.onerror=function(e){R("websocket.onerror"),clearTimeout(c.id),c.heartbeatTimer&&clearTimeout(c.heartbeatTimer),c.curWebsocketErrorRetries++<c.maxWebsocketErrorRetries&&"websocket"!==c.fallbackTransport&&G("Failed to connect via Websocket. Downgrading to "+c.fallbackTransport+" and resending")},u.onclose=function(t){if(R("websocket.onclose"),clearTimeout(c.id),"closed"!==l.state){var r=t.reason;if(""===r)switch(t.code){case 1e3:r="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:r="The endpoint is going away, either because of a server failure or because the browser is navigating away from the page that opened the connection.";break;case 1002:r="The endpoint is terminating the connection due to a protocol error.";break;case 1003:r="The connection is being terminated because the endpoint received data of a type it cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:r="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:r="Unknown: no status code was provided even though one was expected.";break;case 1006:r="Connection was closed abnormally (that is, with no close frame being sent)."}I("warn")&&n.util.warn("Websocket closed, reason: "+r+" - wasClean: "+t.wasClean),l.closedByClientTimeout||c.handleOnlineOffline&&o?c.reconnectId&&(clearTimeout(c.reconnectId),delete c.reconnectId):(Ie(e),l.state="closed",w?n.util.log(c.logLevel,["Websocket closed normally"]):e||"websocket"===c.fallbackTransport?c.reconnect&&"websocket"===l.transport&&(q(),m++<c.maxReconnectOnClose?(N("re-connecting",c.transport,c),c.reconnectInterval>0?c.reconnectId=setTimeout((function(){l.responseBody="",l.messages=[],X(!0)}),c.reconnectInterval):(l.responseBody="",l.messages=[],X(!0))):(n.util.log(c.logLevel,["Websocket reconnect maximum try reached "+m]),I("warn")&&n.util.warn("Websocket error, reason: "+t.reason),V(0,"maxReconnectOnClose reached"))):G("Websocket failed on first connection attempt. Downgrading to "+c.fallbackTransport+" and resending"))}},navigator.userAgent.toLowerCase().indexOf("android")>-1&&void 0===u.url&&u.onclose({reason:"Android 4.1 does not support websockets.",wasClean:!1})):null!=u&&q()}function J(e,t){var o=t;if("polling"===e.transport)return o;if(e.enableProtocol&&e.firstMessage&&0!==n.util.trim(t).length){var r=e.trackMessageLength?1:0,s=t.split(e.messageDelimiter);if(s.length<=r+1)return o;if(e.firstMessage=!1,e.uuid=n.util.trim(s[r]),s.length<=r+2&&n.util.log("error",["Protocol data not sent by the server. If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side.Also note that atmosphere-runtime 2.2+ should be used."]),v=parseInt(n.util.trim(s[r+1]),10),b=s[r+2],"long-polling"!==e.transport&&Z(e),i=e.uuid,o="",r=e.trackMessageLength?4:3,s.length>r+1)for(var a=r;a<s.length;a++)o+=s[a],a+1!==s.length&&(o+=e.messageDelimiter);0!==e.ackInterval&&setTimeout((function(){ue("...ACK...")}),e.ackInterval)}else e.enableProtocol&&e.firstMessage&&n.util.browser.msie&&+n.util.browser.version.split(".")[0]<10?n.util.log(c.logLevel,["Receiving unexpected data from IE"]):Z(e);return o}function z(e){clearTimeout(e.id),e.timeout>0&&"polling"!==e.transport&&(e.id=setTimeout((function(){Q(),O(),q()}),e.timeout))}function Q(e){l.closedByClientTimeout=!0,l.state="closedByClient",l.responseBody="",l.status=408,l.messages=[],Re()}function V(e,t){q(),clearTimeout(c.id),l.state="error",l.reasonPhrase=t,l.responseBody="",l.status=e,l.messages=[],Re()}function $(e,t,n){if(0===(e=J(t,e)).length)return!0;if(n.responseBody=e,t.trackMessageLength){var o=[],r=(e=n.partialMessage+e).indexOf(t.messageDelimiter);if(-1!=r){for(;-1!==r;){var s=e.substring(0,r),i=+s;if(isNaN(i))throw n.partialMessage="",new Error('message length "'+s+'" is not a number');(r+=t.messageDelimiter.length)+i>e.length?r=-1:(o.push(e.substring(r,r+i)),r=(e=e.substring(r+i,e.length)).indexOf(t.messageDelimiter))}return n.partialMessage=e,0!==o.length?(n.responseBody=o.join(t.messageDelimiter),n.messages=o,!1):(n.responseBody="",n.messages=[],!0)}}return n.responseBody=e,n.messages=[e],!1}function G(e){n.util.log(c.logLevel,[e]),void 0!==c.onTransportFailure?c.onTransportFailure(e,c):void 0!==n.util.onTransportFailure&&n.util.onTransportFailure(e,c);var t=-1===c.connectTimeout?0:c.connectTimeout;c.reconnect&&"none"!==c.transport||null==c.transport?(c.transport=c.fallbackTransport,c.method=c.fallbackMethod,l.transport=c.fallbackTransport,l.state="",c.fallbackTransport="none",t>0?c.reconnectId=setTimeout((function(){U()}),t):U()):V(500,"Unable to reconnect with fallback transport")}function K(e,t){var o=c;return null!=e&&void 0!==e&&(o=e),null==t&&(t=o.url),o.attachHeadersAsQueryString?(-1!==t.indexOf("X-Atmosphere-Framework")||(t+=-1!==t.indexOf("?")?"&":"?",t+="X-Atmosphere-tracking-id="+o.uuid,t+="&X-Atmosphere-Framework="+n.version,t+="&X-Atmosphere-Transport="+o.transport,o.trackMessageLength&&(t+="&X-Atmosphere-TrackMessageSize=true"),null!==o.heartbeat&&null!==o.heartbeat.server&&(t+="&X-Heartbeat-Server="+o.heartbeat.server),""!==o.contentType&&(t+="&Content-Type="+("websocket"===o.transport?o.contentType:encodeURIComponent(o.contentType))),o.enableProtocol&&(t+="&X-atmo-protocol=true"),n.util.each(o.headers,(function(r,s){var i=n.util.isFunction(s)?s.call(this,o,e,l):s;null!=i&&(t+="&"+encodeURIComponent(r)+"="+encodeURIComponent(i))}))),t):t}function Z(e){if(e.isOpen)if(e.isReopen)e.isReopen=!1,N("re-opening",e.transport,e);else{if("messageReceived"!==l.state||"jsonp"!==e.transport&&"long-polling"!==e.transport)return;se(l)}else e.isOpen=!0,N("opening",e.transport,e);Y(e)}function Y(e){if(null!=e.heartbeatTimer&&clearTimeout(e.heartbeatTimer),!isNaN(v)&&v>0){var t=function(){I("debug")&&n.util.debug("Sending heartbeat"),ue(b),e.heartbeatTimer=setTimeout(t,v)};e.heartbeatTimer=setTimeout(t,v)}}function ee(e){var t=c;if(null==e&&void 0===e||(t=e),t.lastIndex=0,t.readyState=0,"jsonp"===t.transport||t.enableXDR&&n.util.checkCORSSupport())D(t);else{if(n.util.browser.msie&&+n.util.browser.version.split(".")[0]<10){if("streaming"===t.transport)return void(t.enableXDR&&window.XDomainRequest?ie(t):ce(t));if(t.enableXDR&&window.XDomainRequest)return void ie(t)}var o=function(n){if(t.lastIndex=0,m++,n||t.reconnect&&m<=t.maxReconnectOnClose){var o=n?0:e.reconnectInterval;l.ffTryingReconnect=!0,N("re-connecting",e.transport,e),oe(i,t,o)}else V(0,"maxReconnectOnClose reached")},r=function(e){n._beforeUnloadState?(n.util.debug(new Date+" Atmosphere: reconnectF: execution delayed due to _beforeUnloadState flag"),setTimeout((function(){o(e)}),5e3)):o(e)},s=function(){l.errorHandled=!0,q(),r(!1)};if(t.force||t.reconnect&&(-1===t.maxRequest||t.requestCount++<t.maxRequest)){t.force=!1;var i=n.util.xhr();i.hasData=!1,ne(i,t,!0),t.suspend&&(h=i),"polling"!==t.transport&&(l.transport=t.transport,i.onabort=function(){R("ajaxrequest.onabort"),Ie(!0)},i.onerror=function(){R("ajaxrequest.onerror"),l.error=!0,l.ffTryingReconnect=!0;try{l.status=XMLHttpRequest.status}catch(e){l.status=500}l.status||(l.status=500),l.errorHandled||(q(),r(!1))}),i.onreadystatechange=function(){if(R("ajaxRequest.onreadystatechange, new state: "+i.readyState),w)R("onreadystatechange has been ignored due to _abortingConnection flag");else{l.error=null;var o=!1,a=!1;if("streaming"===t.transport&&t.readyState>2&&4===i.readyState)return q(),void r(!1);if(t.readyState=i.readyState,("streaming"===t.transport&&i.readyState>=3||"long-polling"===t.transport&&4===i.readyState)&&(a=!0),z(c),"polling"!==t.transport){var u=200;if(4===i.readyState&&(u=i.status>1e3?0:i.status),!t.reconnectOnServerError&&u>=300&&u<600)return void V(u,i.statusText);if(u>=300||0===u)return void s();t.enableProtocol&&e.firstMessage||2!==i.readyState||(n.util.browser.mozilla&&l.ffTryingReconnect?(l.ffTryingReconnect=!1,setTimeout((function(){l.ffTryingReconnect||Z(t)}),500)):Z(t))}else 4===i.readyState&&(a=!0);if(a){var d=i.responseText;if(l.errorHandled=!1,"long-polling"===t.transport&&0===n.util.trim(d).length)return void(i.hasData?i.hasData=!1:r(!0));if(i.hasData=!0,ke(i,c),"streaming"===t.transport)if(n.util.browser.opera)n.util.iterate((function(){if(500!==l.status&&i.responseText.length>t.lastIndex){try{l.status=i.status,l.headers=n.util.parseHeaders(i.getAllResponseHeaders()),ke(i,c)}catch(e){l.status=404}z(c),l.state="messageReceived";var e=i.responseText.substring(t.lastIndex);if(t.lastIndex=i.responseText.length,(o=$(e,t,l))||Re(),x(i,t))return void te(i,t)}else if(l.status>400)return t.lastIndex=i.responseText.length,!1}),0);else{var h=d.substring(t.lastIndex,d.length);if(o=$(h,t,l),t.lastIndex=d.length,o)return}else o=$(d,t,l);var p=x(i,t);try{l.status=i.status,l.headers=n.util.parseHeaders(i.getAllResponseHeaders()),ke(i,t)}catch(e){l.status=404}t.suspend?l.state=0===l.status?"closed":"messageReceived":l.state="messagePublished";var f=!p&&"streaming"!==e.transport&&"polling"!==e.transport;f&&!t.executeCallbackBeforeReconnect&&oe(i,t,t.pollingInterval),0===l.responseBody.length||o||Re(),f&&t.executeCallbackBeforeReconnect&&oe(i,t,t.pollingInterval),p&&te(i,t)}}};try{i.send(t.data),g=!0}catch(e){n.util.log(t.logLevel,["Unable to connect to "+t.url]),V(0,e)}}else"debug"===t.logLevel&&n.util.log(t.logLevel,["Max re-connection reached."]),V(0,"maxRequest reached")}}function te(e,t){l.messages=[],t.isReopen=!0,E(),w=!1,oe(e,t,500)}function ne(e,t,o){var r=t.url;null!=t.dispatchUrl&&"POST"===t.method&&(r+=t.dispatchUrl),r=K(t,r),r=n.util.prepareURL(r),o&&(e.open(t.method,r,t.async),t.connectTimeout>0&&(t.id=setTimeout((function(){0===t.requestCount&&(q(),Ce("Connect timeout","closed",200,t.transport))}),t.connectTimeout))),c.withCredentials&&"websocket"!==c.transport&&"withCredentials"in e&&(e.withCredentials=!0),c.dropHeaders||(e.setRequestHeader("X-Atmosphere-Framework",n.version),e.setRequestHeader("X-Atmosphere-Transport",t.transport),null!==t.heartbeat&&null!==t.heartbeat.server&&e.setRequestHeader("X-Heartbeat-Server",e.heartbeat.server),t.trackMessageLength&&e.setRequestHeader("X-Atmosphere-TrackMessageSize","true"),e.setRequestHeader("X-Atmosphere-tracking-id",t.uuid),n.util.each(t.headers,(function(r,s){var i=n.util.isFunction(s)?s.call(this,e,t,o,l):s;null!=i&&e.setRequestHeader(r,i)}))),""!==t.contentType&&e.setRequestHeader("Content-Type",t.contentType)}function oe(e,t,n){if(!l.closedByClientTimeout&&(t.reconnect||t.suspend&&g)){var o=0;e&&e.readyState>1&&(o=e.status>1e3?0:e.status),l.status=0===o?204:o,l.reason=0===o?"Server resumed the connection or down.":"OK",clearTimeout(t.id),t.reconnectId&&(clearTimeout(t.reconnectId),delete t.reconnectId),n>0?c.reconnectId=setTimeout((function(){ee(t)}),n):ee(t)}}function re(e){e.state="re-connecting",Se(e)}function se(e){e.state="openAfterResume",Se(e),e.state="messageReceived"}function ie(e){"polling"!==e.transport?(p=ae(e)).open():ae(e).open()}function ae(e){var t=c;null!=e&&void 0!==e&&(t=e);var o=t.transport,r=0,s=new window.XDomainRequest,i=function(){"long-polling"===t.transport&&t.reconnect&&(-1===t.maxRequest||t.requestCount++<t.maxRequest)&&(s.status=200,ie(t))},a=t.rewriteURL||function(e){var t=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(t&&t[1]){case"JSESSIONID":return e.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+t[2]+"$1");case"PHPSESSID":return e.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+t[2]+"&").replace(/&$/,"")}return e};s.onprogress=function(){u(s)},s.onerror=function(){"polling"!==t.transport&&(q(),m++<t.maxReconnectOnClose?t.reconnectInterval>0?t.reconnectId=setTimeout((function(){N("re-connecting",e.transport,e),ie(t)}),t.reconnectInterval):(N("re-connecting",e.transport,e),ie(t)):V(0,"maxReconnectOnClose reached"))},s.onload=function(){};var u=function(e){clearTimeout(t.id);var s=e.responseText;if(s=s.substring(r),r+=s.length,"polling"!==o){z(t);var a=$(s,t,l);if("long-polling"===o&&0===n.util.trim(s).length)return;t.executeCallbackBeforeReconnect&&i(),a||Ce(l.responseBody,"messageReceived",200,o),t.executeCallbackBeforeReconnect||i()}};return{open:function(){var e=t.url;null!=t.dispatchUrl&&(e+=t.dispatchUrl),e=K(t,e),s.open(t.method,a(e)),"GET"===t.method?s.send():s.send(t.data),t.connectTimeout>0&&(t.id=setTimeout((function(){0===t.requestCount&&(q(),Ce("Connect timeout","closed",200,t.transport))}),t.connectTimeout))},close:function(){s.abort()}}}function ce(e){(p=le(e)).open()}function le(e){var t,o=c;null!=e&&void 0!==e&&(o=e);var r=new window.ActiveXObject("htmlfile");r.open(),r.close();var s=o.url;return null!=o.dispatchUrl&&(s+=o.dispatchUrl),"polling"!==o.transport&&(l.transport=o.transport),{open:function(){var e=r.createElement("iframe");s=K(o),""!==o.data&&(s+="&X-Atmosphere-Post-Body="+encodeURIComponent(o.data)),s=n.util.prepareURL(s),e.src=s,r.body.appendChild(e);var i=e.contentDocument||e.contentWindow.document;t=n.util.iterate((function(){try{if(!i.firstChild)return;var e=i.body?i.body.lastChild:i;e.omgThisIsBroken;var s=function(){var t=e.cloneNode(!0);t.appendChild(i.createTextNode("."));var n=t.innerText;return n=n.substring(0,n.length-1)};if(!i.body||!i.body.firstChild||"pre"!==i.body.firstChild.nodeName.toLowerCase()){var a=i.head||i.getElementsByTagName("head")[0]||i.documentElement||i,u=i.createElement("script");u.text="document.write('<plaintext>')",a.insertBefore(u,a.firstChild),a.removeChild(u),e=i.body.lastChild}return o.closed&&(o.isReopen=!0),t=n.util.iterate((function(){var t=s();if(t.length>o.lastIndex){if(z(c),l.status=200,l.error=null,e.innerText="",$(t,o,l))return"";Ce(l.responseBody,"messageReceived",200,o.transport)}if(o.lastIndex=0,"complete"===i.readyState)return Ie(!0),N("re-connecting",o.transport,o),o.reconnectInterval>0?o.reconnectId=setTimeout((function(){ce(o)}),o.reconnectInterval):ce(o),!1}),null),!1}catch(e){return l.error=!0,N("re-connecting",o.transport,o),m++<o.maxReconnectOnClose?o.reconnectInterval>0?o.reconnectId=setTimeout((function(){ce(o)}),o.reconnectInterval):ce(o):V(0,"maxReconnectOnClose reached"),r.execCommand("Stop"),r.close(),!1}}))},close:function(){t&&t(),r.execCommand("Stop"),Ie(!0)}}}function ue(e){null!=C?he(e):null!=h||null!=d?fe(e):null!=p?ge(e):null!=f?me(e):null!=u?we(e):(V(0,"No suspended connection available"),n.util.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before trying to push data"))}function de(e,t){t||(t=be(e)),t.transport="polling",t.method="GET",t.withCredentials=!1,t.reconnect=!1,t.force=!0,t.suspend=!1,t.timeout=1e3,ee(t)}function he(e){C.send(e)}function pe(e){if(0!==e.length)try{C?C.localSend(e):t&&t.signal("localMessage",JSON.stringify({id:k,event:e}))}catch(e){n.util.error(e)}}function fe(e){ee(be(e))}function ge(e){if(c.enableXDR&&n.util.checkCORSSupport()){var t=be(e);t.reconnect=!1,D(t)}else fe(e)}function me(e){fe(e)}function ve(e){var t=e;return"object"==typeof t&&(t=e.data),t}function be(e){var t=ve(e),o={connected:!1,timeout:6e4,method:"POST",url:c.url,contentType:c.contentType,headers:c.headers,reconnect:!0,callback:null,data:t,suspend:!1,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:c.withCredentials,async:c.async,transport:"polling",isOpen:!0,attachHeadersAsQueryString:!0,enableXDR:c.enableXDR,uuid:c.uuid,dispatchUrl:c.dispatchUrl,enableProtocol:!1,messageDelimiter:"|",trackMessageLength:c.trackMessageLength,maxReconnectOnClose:c.maxReconnectOnClose,heartbeatTimer:c.heartbeatTimer,heartbeat:c.heartbeat};return"object"==typeof e&&(o=n.util.extend(o,e)),o}function we(e){var t,o=n.util.isBinary(e)?e:ve(e);try{if(t=null!=c.dispatchUrl?c.webSocketPathDelimiter+c.dispatchUrl+c.webSocketPathDelimiter+o:o,!u.canSendMessage)return void n.util.error("WebSocket not connected.");u.send(t)}catch(t){u.onclose=function(e){},q(),G("Websocket failed. Downgrading to "+c.fallbackTransport+" and resending "+e),fe(e)}}function ye(e){var t=JSON.parse(e);t.id!==k&&(void 0!==c.onLocalMessage?c.onLocalMessage(t.event):void 0!==n.util.onLocalMessage&&n.util.onLocalMessage(t.event))}function Ce(e,t,n,o){l.responseBody=e,l.transport=o,l.status=n,l.state=t,Re()}function ke(e,t){if(t.readResponsesHeaders)try{var n=e.getResponseHeader("X-Atmosphere-tracking-id");n&&null!=n&&(t.uuid=n.split(" ").pop())}catch(e){}else t.enableProtocol||(t.uuid=k)}function Se(e){Te(e,c),Te(e,n.util)}function Te(e,t){switch(e.state){case"messageReceived":R("Firing onMessage"),m=0,void 0!==t.onMessage&&t.onMessage(e),void 0!==t.onmessage&&t.onmessage(e);break;case"error":R("Firing onError, reasonPhrase: "+(void 0!==e.reasonPhrase?e.reasonPhrase:"n/a")),void 0!==t.onError&&t.onError(e),void 0!==t.onerror&&t.onerror(e);break;case"opening":delete c.closed,R("Firing onOpen"),void 0!==t.onOpen&&t.onOpen(e),void 0!==t.onopen&&t.onopen(e);break;case"messagePublished":R("Firing messagePublished"),void 0!==t.onMessagePublished&&t.onMessagePublished(e);break;case"re-connecting":R("Firing onReconnect"),void 0!==t.onReconnect&&t.onReconnect(c,e);break;case"closedByClient":R("Firing closedByClient"),void 0!==t.onClientTimeout&&t.onClientTimeout(c);break;case"re-opening":delete c.closed,R("Firing onReopen"),void 0!==t.onReopen&&t.onReopen(c,e);break;case"fail-to-reconnect":R("Firing onFailureToReconnect"),void 0!==t.onFailureToReconnect&&t.onFailureToReconnect(c,e);break;case"unsubscribe":case"closed":void 0!==c.closed&&c.closed?R("Request already closed, not firing onClose ("+e.state+" case)"):(R("Firing onClose ("+e.state+" case)"),void 0!==t.onClose&&t.onClose(e),void 0!==t.onclose&&t.onclose(e)),c.closed=!0;break;case"openAfterResume":void 0!==t.onOpenAfterResume&&t.onOpenAfterResume(c)}}function Ie(e){"closed"!==l.state&&(l.state="closed",l.responseBody="",l.messages=[],l.status=e?200:501,Re())}function Re(){var e=function(e,t){t(l)};null==C&&null!=y&&y(l.responseBody),c.reconnect=c.mrequest;for(var t="string"==typeof l.responseBody,o=t&&c.trackMessageLength?l.messages.length>0?l.messages:[""]:new Array(l.responseBody),r=0;r<o.length;r++)if(!(o.length>1&&0===o[r].length||(l.responseBody=t?n.util.trim(o[r]):o[r],null==C&&null!=y&&y(l.responseBody),(0===l.responseBody.length||t&&b===l.responseBody)&&"messageReceived"===l.state))){if(Se(l),s.length>0){I("debug")&&n.util.debug("Invoking "+s.length+" global callbacks: "+l.state);try{n.util.each(s,e)}catch(e){n.util.log(c.logLevel,["Callback exception"+e])}}if("function"==typeof c.callback){I("debug")&&n.util.debug("Invoking request callbacks");try{c.callback(l)}catch(e){n.util.log(c.logLevel,["Callback exception"+e])}}}}A(e),this.subscribe=function(e){A(e),U()},this.execute=function(){U()},this.close=function(){E()},this.disconnect=function(){O()},this.getUrl=function(){return c.url},this.push=function(e,t){if(null!=t){var n=c.dispatchUrl;c.dispatchUrl=t,ue(e),c.dispatchUrl=n}else ue(e)},this.getUUID=function(){return c.uuid},this.pushLocal=function(e){pe(e)},this.enableProtocol=function(e){return c.enableProtocol},this.init=function(){S()},this.request=c,this.response=l}}).subscribe=function(e,t,o){"function"==typeof t&&n.addCallback(t),"string"!=typeof e?o=e:o.url=e,i=void 0!==o&&void 0!==o.uuid?o.uuid:0;var s=new n.AtmosphereRequest(o);return s.execute(),r[r.length]=s,s},n.unsubscribe=function(){if(r.length>0)for(var e=[].concat(r),t=0;t<e.length;t++){var n=e[t];n.close(),clearTimeout(n.response.request.id),n.heartbeatTimer&&clearTimeout(n.heartbeatTimer)}r=[],s=[]},n.unsubscribeUrl=function(e){var t=-1;if(r.length>0)for(var n=0;n<r.length;n++){var o=r[n];if(o.getUrl()===e){o.close(),clearTimeout(o.response.request.id),o.heartbeatTimer&&clearTimeout(o.heartbeatTimer),t=n;break}}t>=0&&r.splice(t,1)},n.addCallback=function(e){-1===n.util.inArray(e,s)&&s.push(e)},n.removeCallback=function(e){var t=n.util.inArray(e,s);-1!==t&&s.splice(t,1)},n.util={browser:{},parseHeaders:function(e){for(var t,n=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,o={};t=n.exec(e);)o[t[1]]=t[2];return o},now:function(){return(new Date).getTime()},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},inArray:function(e,t){if(!Array.prototype.indexOf){for(var n=t.length,o=0;o<n;++o)if(t[o]===e)return o;return-1}return t.indexOf(e)},isBinary:function(e){return/^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(e))},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},getAbsoluteURL:function(e){if(void 0===document.createElement)return e;var t=document.createElement("div");return t.innerHTML='<a href="'+e+'"/>',encodeURI(decodeURI(t.firstChild.href))},prepareURL:function(e){var t=n.util.now(),o=e.replace(/([?&])_=[^&]*/,"$1_="+t);return o+(o===e?(/\?/.test(e)?"&":"?")+"_="+t:"")},trim:function(e){return String.prototype.trim?e.toString().trim():e.toString().replace(/(?:(?:^|\n)\s+|\s+(?:$|\n))/g,"").replace(/\s+/g," ")},param:function(e){var t,o=[];function r(e,t){t=n.util.isFunction(t)?t():null==t?"":t,o.push(encodeURIComponent(e)+"="+encodeURIComponent(t))}function s(e,t){var o;if(n.util.isArray(t))n.util.each(t,(function(t,n){/\[\]$/.test(e)?r(e,n):s(e+"["+("object"==typeof n?t:"")+"]",n)}));else if("[object Object]"===Object.prototype.toString.call(t))for(o in t)s(e+"["+o+"]",t[o]);else r(e,t)}for(t in e)s(t,e[t]);return o.join("&").replace(/%20/g,"+")},storage:function(){try{return!(!window.localStorage||!window.StorageEvent)}catch(e){return!1}},iterate:function(e,t){var n;return t=t||0,function o(){n=setTimeout((function(){!1!==e()&&o()}),t)}(),function(){clearTimeout(n)}},each:function(e,t,o){if(e){var r=0,s=e.length,i=n.util.isArray(e);if(o){if(i)for(;r<s&&!1!==t.apply(e[r],o);r++);else for(r in e)if(!1===t.apply(e[r],o))break}else if(i)for(;r<s&&!1!==t.call(e[r],r,e[r]);r++);else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e}},extend:function(e){var t,n,o;for(t=1;t<arguments.length;t++)if(null!=(n=arguments[t]))for(o in n)e[o]=n[o];return e},on:function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},off:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},log:function(e,t){if(window.console){var n=window.console[e];"function"==typeof n&&n.apply(window.console,t)}},warn:function(){n.util.log("warn",arguments)},info:function(){n.util.log("info",arguments)},debug:function(){n.util.log("debug",arguments)},error:function(){n.util.log("error",arguments)},xhr:function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}},checkCORSSupport:function(){if(n.util.browser.msie&&!window.XDomainRequest&&+n.util.browser.version.split(".")[0]<11)return!0;if(n.util.browser.opera&&+n.util.browser.version.split(".")<12)return!0;if("KreaTVWebKit/531"===n.util.trim(navigator.userAgent).slice(0,16))return!0;if("kreatel"===n.util.trim(navigator.userAgent).slice(-7).toLowerCase())return!0;var e=navigator.userAgent.toLowerCase().match(/.+android ([0-9]{1,2})/i),t=parseInt(e&&e[0]||-1,10);return!isNaN(t)&&t>-1&&t<3}},n.util.now(),e=navigator.userAgent.toLowerCase(),"safari"===(t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(e)||e.indexOf("android")<0&&/version\/(.+) (safari)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[])[2]&&(t[2]=t[1],t[1]="safari"),n.util.browser[t[1]||""]=!0,n.util.browser.version=t[2]||"0",n.util.browser.vmajor=n.util.browser.version.split(".")[0],n.util.browser.trident&&(n.util.browser.msie=!0),(n.util.browser.msie||n.util.browser.mozilla&&1==+n.util.browser.version.split(".")[0])&&(n.util.storage=!1),n.callbacks={unload:function(){n.util.debug(new Date+" Atmosphere: unload event"),n.unsubscribe()},beforeUnload:function(){n.util.debug(new Date+" Atmosphere: beforeunload event"),n._beforeUnloadState=!0,setTimeout((function(){n.util.debug(new Date+" Atmosphere: beforeunload event timeout reached. Reset _beforeUnloadState flag"),n._beforeUnloadState=!1}),5e3)},offline:function(){if(n.util.debug(new Date+" Atmosphere: offline event"),o=!0,r.length>0)for(var e=[].concat(r),t=0;t<e.length;t++){var s=e[t];s.request.handleOnlineOffline&&(s.close(),clearTimeout(s.response.request.id),s.heartbeatTimer&&clearTimeout(s.heartbeatTimer))}},online:function(){if(n.util.debug(new Date+" Atmosphere: online event"),r.length>0)for(var e=0;e<r.length;e++)r[e].request.handleOnlineOffline&&(r[e].init(),r[e].execute());o=!1}},n.bindEvents=function(){n.util.on(window,"unload",n.callbacks.unload),n.util.on(window,"beforeunload",n.callbacks.beforeUnload),n.util.on(window,"offline",n.callbacks.offline),n.util.on(window,"online",n.callbacks.online)},n.unbindEvents=function(){n.util.off(window,"unload",n.callbacks.unload),n.util.off(window,"beforeunload",n.callbacks.beforeUnload),n.util.off(window,"offline",n.callbacks.offline),n.util.off(window,"online",n.callbacks.online)},n.bindEvents(),n}()})),o=1e3,r=60*o,s=60*r,i=24*s,a=7*i,c=365.25*i,l=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*c;case"weeks":case"week":case"w":return n*a;case"days":case"day":case"d":return n*i;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*r;case"seconds":case"second":case"secs":case"sec":case"s":return n*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return u(e,t,i,"day");if(t>=s)return u(e,t,s,"hour");if(t>=r)return u(e,t,r,"minute");if(t>=o)return u(e,t,o,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=s)return Math.round(e/s)+"h";if(t>=r)return Math.round(e/r)+"m";if(t>=o)return Math.round(e/o)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function u(e,t,n,o){var r=t>=1.5*n;return Math.round(e/n)+" "+o+(r?"s":"")}var d=function(e){function t(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return n.colors[Math.abs(t)%n.colors.length]}function n(e){var s;function i(){if(i.enabled){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];var r=i,a=Number(new Date),c=a-(s||a);r.diff=c,r.prev=s,r.curr=a,s=a,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");var l=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(function(e,o){if("%%"===e)return e;l++;var s=n.formatters[o];if("function"==typeof s){var i=t[l];e=s.call(r,i),t.splice(l,1),l--}return e})),n.formatArgs.call(r,t);var u=r.log||n.log;u.apply(r,t)}}return i.namespace=e,i.enabled=n.enabled(e),i.useColors=n.useColors(),i.color=t(e),i.destroy=o,i.extend=r,"function"==typeof n.init&&n.init(i),n.instances.push(i),i}function o(){var e=n.instances.indexOf(this);return-1!==e&&(n.instances.splice(e,1),!0)}function r(e,t){return n(this.namespace+(void 0===t?":":t)+e)}return n.debug=n,n.default=n,n.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},n.disable=function(){n.enable("")},n.enable=function(e){var t;n.save(e),n.names=[],n.skips=[];var o=("string"==typeof e?e:"").split(/[\s,]+/),r=o.length;for(t=0;t<r;t++)o[t]&&("-"===(e=o[t].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")));for(t=0;t<n.instances.length;t++){var s=n.instances[t];s.enabled=n.enabled(s.namespace)}},n.enabled=function(e){if("*"===e[e.length-1])return!0;var t,o;for(t=0,o=n.skips.length;t<o;t++)if(n.skips[t].test(e))return!1;for(t=0,o=n.names.length;t<o;t++)if(n.names[t].test(e))return!0;return!1},n.humanize=l,Object.keys(e).forEach((function(t){n[t]=e[t]})),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=t,n.enable(n.load()),n},h=t((function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}t.log=function(){var e;return"object"===("undefined"==typeof console?"undefined":n(console))&&console.log&&(e=console).log.apply(e,arguments)},t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;var n="color: "+this.color;t.splice(1,0,n,"color: inherit");var o=0,r=0;t[0].replace(/%[a-zA-Z%]/g,(function(e){"%%"!==e&&(o++,"%c"===e&&(r=o))})),t.splice(r,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){var e;try{e=t.storage.getItem("debug")}catch(e){}!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.exports=d(t),e.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}));let p={connection:h("atmosphere-client:connection"),connectionRaw:h("atmosphere-client:connection-raw"),incoming:h("atmosphere-client:incoming"),incomingRaw:h("atmosphere-client:incoming-raw"),outgoing:h("atmosphere-client:outgoing"),outgoingRaw:h("atmosphere-client:outgoing-raw")};const f="close",g="reconnecting",m="disconnect";class v{constructor(e,t=60){this.socket=e,this.pingInterval=t}start(){let e=this;this.stop(),this.pingTimeoutId=window.setInterval((function(){e._ping()}),1e3*e.pingInterval)}stop(){this.pingTimeoutId&&(window.clearInterval(this.pingTimeoutId),this.pingTimeoutId=null)}_ping(){this.socket.send("core.ping")}}class b{constructor(e,t){this.fn=e,this.wasCalled=!1,this.timeInSeconds=t,this._start()}_start(){var e=this;this.timerId=window.setInterval((function(){e._step()}),1e3)}_step(){this.wasCalled||(this.timeInSeconds-=1,this.timeInSeconds<=0&&(this.wasCalled=!0,this.stop(),this.fn()))}stop(){window.clearInterval(this.timerId)}getCountdown(){return this.timeInSeconds}}class w{constructor(e){this.socket=e,this.pingInterval=this.getInitialPingInterval()}getRandomInt(e,t){return Math.floor(Math.random()*(t-e+1))+e}getInitialPingInterval(){return this.getRandomInt(10,30)}activateThrottling(){let e=this.getRandomInt(60,120);this.pingInterval=Math.max(this.pingInterval,e)}start(){let e=this;this.stop(),this.countdownTimer=new b((function(){e._ping()}),e.pingInterval),this.resetTimer&&clearTimeout(this.resetTimer)}reset(){let e=this;this.resetTimer=setTimeout((function(){e.pingInterval=e.getInitialPingInterval(),e.resetTimer=null}),3e5),this.stop()}stop(){this.countdownTimer&&(this.countdownTimer.stop(),this.countdownTimer=null)}getCountdown(){return this.countdownTimer?this.countdownTimer.getCountdown():0}_ping(){this.stop(),this.socket.reconnect(),this.pingInterval+=this.pingInterval;var e=this.getRandomInt(60,90);this.pingInterval=Math.max(e,Math.min(this.pingInterval,300)),this.start()}}class y{constructor(e,t=1e4){let n=this;if(0===t)throw new Error("flushInterval cannot be zero");this.socket=e,this.flushInterval=t,this.queue=[],this.measurements={},window.setInterval((function(){n._flush()}),n.flushInterval)}start(e,t){this.measurements[e]={name:e,time:t||Date.now()}}stop(e,t){let n=this.measurements[e];n&&(n.time=(t||Date.now())-n.time,this.queue.push(n),delete this.measurements[e])}_flush(){this.queue.length&&(this.socket.isConnected()&&this.socket.emit("metric.batch",{list:this.queue}),this.queue=[])}}class C{constructor(e){this.capacity=e,this.buffer=[],this.length=0,this.pointer=0}get(e){return this.buffer[e]}push(e){this.buffer[this.pointer]=e,this.pointer=(this.capacity+this.pointer+1)%this.capacity,this.length=this.buffer.length}all(){return 0===this.pointer||this.buffer.length<this.capacity?this.buffer:this.buffer.slice(this.pointer).concat(this.buffer.slice(0,this.pointer))}}class k{constructor(e,t,n){this.baseUrl=t,this.messageQueue=[],this.requests={},this.requestIdSeq=1,this.eventHandlers={},this.query={},this.logErrors=!0,this.atmosphere=e,this.ackTimeout=n&&n.ackTimeout||3e4,this.eventsMaxCount=n&&n.eventsMaxCount||500,this.eventsDataMaxSize=n&&n.eventsDataMaxSize||1e4,this.events=new C(this.eventsMaxCount),this.trackMessageLength=!n||!1!==n.trackMessageLength,n&&n.metric&&n.metric.enabled&&(this.tlMetric=new y(this,n.metric.flushInterval)),this.libVersion="{{ VERSION }}",this.keepAlivePing=new v(this),this.reconnectPing=new w(this),n&&n.query&&(this.query=n.query),this.online=!this.query||!0!==this.query.setOnlineUndefined||void 0,this.query.app||(this.query.app="other"),this.query.libVersion=this.libVersion,this.trackMessageLength&&(this.query.tml=this.trackMessageLength),this._startOnlineCheck()}_addEvent(e,t){var n={timestamp:Date.now(),eventType:e};void 0!==t&&(n.data=t),"string"==typeof t&&(n.data=t.substring(0,this.eventsDataMaxSize)),this.events.push(n)}_push(e){this.tlMetric&&e.requestId&&this.tlMetric.start("rid:"+e.requestId);let t=JSON.stringify(e);var n;if(t.length>3e6)return console.warn("Request max frame size limit excedded, dropping frame"),void(e.requestId&&(n=this.requests[e.requestId])&&n.promise.reject({type:"error",message:"Request max frame size limit excedded"}));this.socket.push(t),"auth"===e.eventName&&e.args&&e.args.password&&((e=JSON.parse(t)).args.password="******",t=JSON.stringify(e)),p.outgoingRaw(t),p.outgoing(e),this._addEvent("out",t)}_pushWhenConnected(e){this.isConnected()?this._push(e):this.messageQueue.push(e)}_resetMessageQueue(){this.messageQueue.length=0}_processMessageQueue(){this._forEach(this.messageQueue,this._push),this._resetMessageQueue()}_changeSocketStatus(e,t){let n=e;this.socketStatus===f&&e!==g||("clientTimeout"!==e&&"error"!==e||(e=m),"reconnect"!==e&&"connect"!==e||(e=this.wasConnected?"reconnect":"connect"),p.connectionRaw("setting status to "+e+" | "+n),this.socketStatus!==e&&(["connect","reconnect","offline"].indexOf(this.socketStatus)>=0&&e===m&&this.wasConnected&&(this.keepAlivePing.stop(),this.reconnectPing.start()),void 0===this.wasConnected&&this.socketStatus===m&&e===g&&(this.keepAlivePing.stop(),this.reconnectPing.start()),"offline"===e&&(this.keepAlivePing.stop(),this.reconnectPing.reset()),"connect"!==e&&"reconnect"!==e||(p.connectionRaw("starting keep alive ping"),this.wasConnected=!0,this._processMessageQueue(),this.keepAlivePing.start(),this.reconnectPing.reset()),this.socketStatus=e,this.dispatchEvent(e,t)))}_setOnline(e){this.online!==e&&(this.online=e,e?(this._changeSocketStatus(m),this.reconnect()):this._changeSocketStatus("offline"))}_startOnlineCheck(){let e=this;"onLine"in window.navigator&&(window.setInterval((function(){!1===e.online&&window.navigator.onLine&&e._setOnline(!0)}),3e3),this.atmosphere.util.on(window,"online",(function(){e._setOnline(!0)})),this.atmosphere.util.on(window,"offline",(function(){e._setOnline(!1)})))}dispatchEvent(e,t){let n=this.eventHandlers[e];n&&n.length&&this._forIn(n,(function(e){e(t)}))}_logError(){let e=Array.prototype.slice.call(arguments);(this.debug||this.logErrors)&&(e.unshift("[transport-layer-client]"),console.error.apply(console,e))}_cleanSocket(){let e=this.socket;this.socket=null,e&&this.atmosphere.unsubscribe(),this._forIn(this.requests,(function(e){e.promise.reject([{type:"connect",message:"Sorry, but there was an issue communicating with the server."}])})),this.requests={},this._resetMessageQueue(),this.requestIdSeq=1}_connect(){let e=this;if(this.socket)return;let t=this.baseUrl.split("?")[0];if(this.oldConnId&&(this.query.connIdsToClose=this.oldConnId),this.query){t+="?";let e=[];this._forIn(this.query,(function(t,n){e.push(n+"="+encodeURIComponent(t))})),t+=e.join("&")}let n=(new this.atmosphere.AtmosphereRequest).request;n.url=t,n.enableXDR=!0,n.transport="websocket",n.fallbackTransport="none",n.reconnect=!1,n.connectTimeout=25e3,n.reconnectInterval=3e5,n.timeout=9e4,n.maxReconnectOnClose=100,n.closeAsync=!0,n.trackMessageLength=e.trackMessageLength;e._forIn({connect:"Open",disconnect:"Close",reconnecting:"Reconnect",reconnect:"Reopen",error:"Error",clientTimeout:"ClientTimeout"},(function(t,o){n["on"+t]=function(t){if(p.connection(o),p.connectionRaw(o),e._addEvent(o,t.responseBody),o===e.socketStatus)return;"error"!==o&&o!==m&&"clientTimeout"!==o||e._cleanSocket();let n={};try{"error"===o?n=t.reasonPhrase:"connect"===o?t.request&&(n=t.request.uuid,e.oldConnId=n):n=JSON.parse(t.responseBody)}catch(e){}e._changeSocketStatus(o,n)}})),n.onMessage=function(t){let n=Date.now(),o=t.responseBody;e.lastMessageTimestamp=n,p.incomingRaw(o),e._addEvent("in",o);try{e.query&&e.query.base64&&(o=e.decodeBase64Data(o)),o=JSON.parse(o),p.incoming(o)}catch(t){"X"!==o&&e._logError("failed to parse response body:",t,o)}e.isConnected()||(o.connectionId&&(e.oldConnId=o.connectionId),e._changeSocketStatus("connect"));let r=o.requestId,s=r&&e.requests[r];if(s){e.tlMetric&&e.tlMetric.stop("rid:"+r,n),window.clearTimeout(s.timeoutId);let t=s.promise;if(delete e.requests[r],o.errors){if(429===o.errors[0].code&&s.tries<2)return void setTimeout((function(){e._send(s)}),1e3);t.reject(o.errors)}else t.resolve(o.data)}else{let t=o.eventName;if(t){if(e.dispatchEvent(t,o.data),"CONNECTION_CLOSED"===t&&o.data)switch(o.data.reason){case"CONN_CLOSED_REASON_CONNS_LIMIT_REACHED":e.close(o.data.reason);break;case"CLOSING_CONNECTION_DUE_TO_THROTTLING":e.reconnectPing.activateThrottling(),e._cleanSocket();break;default:e._cleanSocket()}}else o.errors&&o.errors.length&&0===r?(e._forIn(e.requests,(function(e){e.promise.reject(o.errors)})),e.requests={}):o.type?e.dispatchEvent(o.type,o):0===r&&e.dispatchEvent("CONNECTION_SUCCESS",o.data)}},e.socket=e.atmosphere.subscribe(n)}decodeBase64Data(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}isClosed(){return this.socketStatus===f}reconnect(){this._changeSocketStatus(g),this.send("core.ping")}close(e){return this._changeSocketStatus(f,e),this.disconnect()}disconnect(){this.wasConnected=!1,p.connection("explicit disconnect"),this._addEvent("explicitDisconnect"),this.keepAlivePing.stop(),this.reconnectPing.stop(),this._forIn(this.requests,(function(e){e.promise.reject({errors:[{type:"connect",message:"Sorry, but there was an issue communicating with the server."}]})})),this._cleanSocket()}getSocketStatus(){return this.socketStatus}getReconnectCountdown(){return this.reconnectPing.getCountdown()}isConnected(){return this.socket&&("connect"===this.socketStatus||"reconnect"===this.socketStatus)}getEvents(){return this.events.all()}getLastMessageTimestamp(){return this.lastMessageTimestamp}on(e,t){let n=this;return this.eventHandlers[e]||(n.eventHandlers[e]=[]),n.eventHandlers[e].push(t),function(){n._off(e,t)}}_off(e,t){let n=this.eventHandlers[e],o=n&&n.indexOf(t);n&&-1!==o&&n.splice(o,1)}_getNextRequestId(){return this.requestIdSeq++}_send(e){let t=this,n=this._getNextRequestId();var o=this.ackTimeout;h.enabled("atmosphere-client:latency")&&(o*=2),this._connect(),e.requestId=n,this.requests[n]=e,e.timeoutId=window.setTimeout((function(){let e=t.requests[n];e&&e.promise&&(t.tlMetric&&t.tlMetric.stop("rid:"+n),e.promise.reject([{type:"timeout",message:"Sorry, but there was an issue communicating with the server.",data:{timeout:t.ackTimeout,args:[e.eventName,e.args]}}]),delete t.requests[n])}),o),e.tries++;let r={requestId:e.requestId,eventName:e.eventName,eventType:e.eventType,args:e.args};h.enabled("atmosphere-client:latency")&&(r.latency=!0),this._pushWhenConnected(r)}send(e,t){if(this.isClosed())return Promise.reject({type:f,message:"The connection is currently closed, no requests allowed"});if("core.ping"!==e&&!this.isConnected()&&this.wasConnected)return Promise.reject({type:f,message:"The connection is currently reconnecting, no requests allowed"});let n,o=new Promise((function(o,r){n={tries:0,promise:{resolve:o,reject:r},eventName:e,eventType:"RPC",args:t}}));return this._send(n),o}emit(e,t){let n;this.isClosed()||!this.isConnected()&&this.wasConnected||(this._connect(),n={eventName:e,eventType:"CLIENT_PUSH",data:t},this._pushWhenConnected(n))}_forEach(e,t){let n,o=0;for(;n=e[o++];)t.call(this,n)}_forIn(e,t){for(let n in e)t.call(this,e[n],n)}}let S;const T={app:"unspecified",tml:!0,base64:!0,url:"https://tl.upwork.com/wp",messageCountsInterval:1200};let I={...T};function R(){if(!I.url)throw new Error('Please provide the "url" configuration option');if(!S){const t={trackMessageLength:!0,metric:{flushInterval:1e4,enabled:!0}};e=I.url,S=new k(n,e,t)}var e;return Object.assign(S.query,{app:I.app,tml:!0,base64:I.base64}),I.orgUid&&Object.assign(S.query,{orgUid:I.orgUid}),I.authToken&&Object.assign(S.query,{oauth2_token:I.authToken}),I.token&&Object.assign(S.query,{token:I.token}),S}class x{constructor(){this.listeners={}}on(e,t){return this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(t),()=>{this.off(e,t)}}off(e,t){if(!t)return void(this.listeners[e]=[]);if(!this.listeners[e])return;const n=this.listeners[e].findIndex((e=>e===t));-1!==n&&this.listeners[e].splice(n,1)}trigger(e,t){if(!this.listeners[e])return;const n={eventName:e,data:t};this.listeners[e].forEach((e=>{e(n)}))}}const O={WorkplaceNotificationsDesktop:{notifyWhen:"important"},WorkplaceMessageCounter:{show:"all"},orgIds:[]};const E=new class extends x{constructor(){super(),this.started=!1,this.loaded=!1}start(){this.started||(this.started=!0,this.stopPreferenceChangeWatch=R().on("PREFERENCES_UPDATE",(e=>{e.forEach((e=>{e.componentName&&(O[e.componentName]=O[e.componentName]||{},e.preferences.forEach((t=>{O[e.componentName][t.prefKey]=t.prefValue})))})),this.trigger("preferencesUpdate",{...O})})),this.stopOutOfOfficeWatch=this.on("preferencesUpdate",(()=>{O.DashOutOfOffice&&this.trigger("dashOutOfOfficeUpdate",{...O.DashOutOfOffice})})),this.fetch(!0).then((()=>{this.trigger("preferencesUpdate",{...O})})))}stop(){this.started&&(this.stopOutOfOfficeWatch(),this.stopOutOfOfficeWatch=null,this.stopPreferenceChangeWatch(),this.stopPreferenceChangeWatch=null,this.started=!1)}async fetch(e=!1){if(!(!this.loaded||e))return O;const t=R(),n=await t.send("prefs.getSettings",{global:"true"});this.loaded=!0,(e=>{let t=!1;e.componentPreferences=e.componentPreferences||[],e.componentPreferences.forEach((e=>{"WorkplaceMessageCounter"===e.componentName&&(t=!0),O[e.componentName]||(O[e.componentName]={}),e.preferences=e.preferences||[],e.preferences.forEach((t=>{O[e.componentName][t.prefKey]=t.prefValue}))})),t||"important"!==O.WorkplaceNotificationsDesktop.notifyWhen||(O.WorkplaceMessageCounter.show="important")})(n);const o=await t.send("auth");return o.organizations&&o.organizations.forEach((e=>{O.orgIds.push(e.uid)})),O}},q=3;const M=new class extends x{setUserUid(e){this.userUid=e}broadcast(e){e=e===q||"invisible"===e?"INVISIBLE":"VISIBLE",this.trigger("visibilityChange",{visibility:e})}update(e){const t=new URLSearchParams;return t.set("visibility",e),fetch("/messages/visibility",{method:"POST",credentials:"same-origin",body:t})}async fetch(){const e=await R().send("getPresence",{ids:[this.userUid]});if(e.list&&e.list[this.userUid]){"INVISIBLE"===e.list[this.userUid]?this.broadcast("invisible"):this.broadcast("online")}}start(){this.stopPresence||(this.stopPresence=R().on("presence",(e=>{this.userUid===e.userId&&this.broadcast(e.show)})),this.fetch())}stop(){this.stopPresence&&(this.stopPresence(),this.stopPresence=null)}},A={};const F=new class extends x{async processMessageCounts(e){const t=await E.fetch();return e.counts.forEach((e=>{const n="all"===t.WorkplaceMessageCounter.show?e.unreadStoriesCount:e.mentionsCount;A[e.orgId]={...e,type:"dash",unread:n,unimportant:e.unreadStoriesCount,port:e.orgId}})),A}async fetch(){const e=await R().send("getMessageCounts",{});return this.processMessageCounts(e)}start(){this.messageCountsPoll||(this.fetch().then((()=>{this.trigger("messageCountsUpdate",{messageCounts:A})})),this.messageCountsPoll=setInterval((()=>{this.fetch().then((()=>{this.trigger("messageCountsUpdate",{messageCounts:A})}))}),1e3*(I.messageCountsInterval||1200))),this.stopUserUpdateNotification||(this.stopUserUpdateNotification=R().on("updateRoomUserNotifcation",(e=>{e.orgCounts&&this.processMessageCounts(e.orgCounts).then((()=>{this.trigger("messageCountsUpdate",{messageCounts:A})}))})))}stop(){clearInterval(this.messageCountsPoll),this.messageCountsPoll=null,this.stopUserUpdateNotification&&(this.stopUserUpdateNotification(),this.stopUserUpdateNotification=null)}};const P=new class extends x{start(){this.notificationPoll||(this.notificationPoll=R().on("notification",(e=>{this.trigger("notificationEvent",e)})))}stop(){this.stopPresence&&(this.notificationPoll(),this.notificationPoll=null)}};let U=!1,L=0,_=!1,N=null,D=null;function B({initial:e}={}){if(!e&&window.dashApiScript.config.idle.enabled){window.dashApiScript.config.idle.debug&&console.log("idle check",{started:U,idleTime:L,idling:_,config:window.dashApiScript.config.idle});const e=R();L+=1,L>=window.dashApiScript.config.idle.timeout?_||(_=!0,e.query.presence="away",e.emit("presence",{show:"away"})):_&&(_=!1,e.query.presence="online",e.emit("presence",{show:"online"}))}N=window.setTimeout(B,1e3)}function j({initial:e}={}){if(!e){const e=R();_?e.emit("presence",{show:"away"}):e.emit("presence",{show:"online"})}D=window.setTimeout(j,6e5)}const W=()=>{L=0},H=["mousemove","keydown","DOMMouseScroll","mousewheel","mousedown","touchstart"];const X=new class extends x{start(){U||(window&&(window.dashApiScript=window.dashApiScript||{},window.dashApiScript.config=window.dashApiScript.config||{},window&&!window.dashApiScript.config.idle&&(console.warn("Please configure dash-api Idle service by setting up a `window.dashApiScript.config.idle` object\nor by passing it to the Idle constructor.\n\nwindow.dashApiScript.config.idle = {\n  timeout: 300, // Idle timeout in seconds\n  debug: false, // Show debug output\n  enabled: true, // When set to `false` will stop changing the status\n};\n"),window.dashApiScript.config.idle={enabled:!1})),U=!0,this.stopIdleWatch=R().on("connect",(()=>{H.forEach((e=>document.addEventListener(e,W))),B({initial:!0}),j({initial:!0})})))}stop(){U&&(H.forEach((e=>document.removeEventListener(e,W))),this.stopIdleWatch(),delete R().query.presence,window.clearInterval(N),window.clearInterval(D),N=null,D=null,U=!1,L=0,_=!1)}};return e.configure=function(e={}){I={...T,...e}},e.connect=function(){R().reconnect()},e.getWebSocket=R,e.idleService=X,e.messageCountsService=F,e.notificationService=P,e.preferenceService=E,e.reconnect=function(){R().reconnect()},e.visibilityService=M,Object.defineProperty(e,"__esModule",{value:!0}),e}({});